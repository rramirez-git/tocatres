{% extends "global/html_struct.html" %}
{% load humanize %}
{% load i18n %}

{% block content %}

<p class="lead">
    Saldo Acual: 
    {% language 'en' %}
        {{ saldo | intcomma }}
    {% endlanguage %}
</p>

<table class="table table-striped table-sm table-responsive-md">
    <thead>
        <tr>
            <th>Fecha</th>
            <th>Factura / Pago</th>
            <th>Concepto</th>
            <th>Ventas</th>
            <th>Pagos</th>
            <th>Saldo</th>
            <th colspan="2"></th>
        </tr>
    </thead>
    <tbody id="data-tbl">
        {% for mov in movimientos %}
            <tr>
                <td>{{ mov.fecha | date:"d/m/Y" }}</td>
                <td class="text-center">{{ mov.referencia }}</td>
                <td>{{ mov.concepto }}</td>
                {% language 'en' %}
                    <td class="text-right">{{ mov.ventas | intcomma }}</td>
                    <td class="text-right">{{ mov.pagos | intcomma }}</td>
                    <td class="text-right">{{ mov.saldo | intcomma }}</td>
                {% endlanguage %}
                <td>
                    {% if mov.es_venta %}
                        {% if perms.productos.actualizar_venta_cargo %}
                            {% if mov.actualizable %}
                                <button onclick="Prod.showChargePaymentFormEdit( {{ cte.pk }}, {{ mov.pk }}, 'venta', '{{ mov.fecha | date:"Y-m-d" }}', {{ mov.monto }}, '{{ mov.concepto }}' )" class="btn btn-outline-secondary" title="Actualizar">
                                    <i class="far fa-edit"></i>
                                </button>
                            {% else %}
                                {% if usr_is_admin %}
                                    <button onclick="Prod.showChargePaymentFormEdit( {{ cte.pk }}, {{ mov.pk }}, 'venta', '{{ mov.fecha | date:"Y-m-d" }}', {{ mov.monto }}, '{{ mov.concepto }}' )" class="btn btn-outline-secondary" title="Actualizar">
                                        <i class="far fa-edit"></i>
                                    </button>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    {% else %}
                        {% if perms.productos.actualizar_pago_abono %}
                            {% if mov.actualizable %}
                                <button onclick="Prod.showChargePaymentFormEdit( {{ cte.pk }}, {{ mov.pk }}, 'pago', '{{ mov.fecha | date:"Y-m-d" }}', {{ mov.monto }}, '{{ mov.concepto }}' )" class="btn btn-outline-secondary" title="Actualizar">
                                    <i class="far fa-edit"></i>
                                </button>
                            {% else %}
                                {% if usr_is_admin %}
                                    <button onclick="Prod.showChargePaymentFormEdit( {{ cte.pk }}, {{ mov.pk }}, 'pago', '{{ mov.fecha | date:"Y-m-d" }}', {{ mov.monto }}, '{{ mov.concepto }}' )" class="btn btn-outline-secondary" title="Actualizar">
                                        <i class="far fa-edit"></i>
                                    </button>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </td>
                <td>
                    {% if mov.es_venta %}
                        {% if perms.productos.remover_cargo_cargo %}
                            {% if mov.actualizable %}
                                <a href="{% url 'cargos_abonos_eliminar_cargo' pk=mov.pk pkcte=cte.pk %}" class="btn btn-outline-secondary" title="Eliminar">
                                    <i class="far fa-trash-alt"></i>
                                </a>
                            {% else %}
                                {% if usr_is_admin %}
                                    <a href="{% url 'cargos_abonos_eliminar_cargo' pk=mov.pk pkcte=cte.pk %}" class="btn btn-outline-secondary" title="Eliminar">
                                        <i class="far fa-trash-alt"></i>
                                    </a>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    {% else %}
                        {% if perms.productos.remover_abono_abono %}
                            {% if mov.actualizable %}
                                <a href="{% url 'cargos_abonos_eliminar_abono' pk=mov.pk pkcte=cte.pk %}" class="btn btn-outline-secondary" title="Eliminar">
                                    <i class="far fa-trash-alt"></i>
                                </a>
                            {% else %}
                                {% if usr_is_admin %}
                                    <a href="{% url 'cargos_abonos_eliminar_abono' pk=mov.pk pkcte=cte.pk %}" class="btn btn-outline-secondary" title="Eliminar">
                                        <i class="far fa-trash-alt"></i>
                                    </a>
                                {% endif %}
                            {% endif %}
                        {% endif %}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<script type="text/x-handlebars-template" id="editar-venta-pago-template">
    <form method="post" autocomplete="off" enctype="multipart/form-data">
        {% csrf_token %}
        {% verbatim %}
        <input type="hidden" name="idcte" value="{{idcte}}" />
        <input type="hidden" name="pk" value="{{pk}}" />
        <input type="hidden" name="type" value="{{type}}" />
        <input type="hidden" name="action" value="edit-mov" />
        <div class="form-row">
            <div class="col form-group">
                <label for="fecha">Fecha</label>
                <input type="date" class="form-control" id="fecha" name="fecha" value="{{fecha}}" required="required" />
            </div>
            <div class="col form-group">
                <label for="monto">Monto</label>
                <input type="text" class="form-control" id="monto" name="monto" value="{{monto}}" required="required" />
            </div>
        </div>
        <div class="form-row">
            <div class="col form-group">
                <label for="concepto">Concepto</label>
                <input type="text" class="form-control" id="concepto" name="concepto" value="{{concepto}}" required="required" />
            </div>
        </div>
        <button type="submit" class="btn btn-outline-primary">Actualizar</button>
        {% endverbatim %}
    </form>
</script>

<script type="text/javascript">
    {% if req_ui %}
        let req_ui = true;
    {% else %}
        let req_ui = false;
    {% endif %}
</script>

{% endblock %}

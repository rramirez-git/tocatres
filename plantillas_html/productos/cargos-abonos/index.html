{% extends "global/html_struct.html" %}
{% load humanize %}
{% load i18n %}

{% block content %}

{% if mensaje %}
<div class="alert alert-{{ mensaje.type }}" role="alert">
    {{ mensaje.msg | safe }}
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>
{% endif %}

<script type="text/javascript">
    let productos = [
        { "pk" : 0, "precio": 0, "nombre" : "" }
        {% for p in products %}
            , { "pk" : {{ p.pk }}, "precio" : {{ p.precio_de_venta }}, "nombre": `{{ p | safe }}` }
        {% endfor %}
    ];
    {% if req_ui %}
        let req_ui = true;
    {% else %}
        let req_ui = false;
    {% endif %}
</script>

<script type="text/x-handlebars-template" id="aplicar-cargo-template">
    <form method="post" autocomplete="off" enctype="multipart/form-data">
        {% csrf_token %}
        {% verbatim %}
        <input type="hidden" name="action" value="addcharge" />
        <input type="hidden" name="cte" value="{{cte}}" />
        <div class="form-row">
            <div class="col form-group">
                <label for="fecha_cargo">Fecha</label>
                <input type="date" class="form-control" id="fecha_cargo" name="fecha_cargo" value="{{today}}" required="required" />
            </div>
            <div class="col form-group">
                <label for="factura">Factura</label>
                <input type="text" class="form-control" id="factura" name="factura" value="" maxlength="20" required="required" />
            </div>
            <div class="col form-group">
                <label for="product">Producto</label>
                <select class="form-control" id="product" name="product" onchange="Prod.setChargeInfo()">
                    {{#each prods}}
                        <option value="{{pk}}">{{{nombre}}}</option>
                    {{/each}}
                </select>
            </div>
        </div>
        <div class="form-row">
            <div class="col form-group">
                <label for="concepto_cargo">Concepto</label>
                <input type="text" class="form-control" id="concepto_cargo" name="concepto_cargo" value="" maxlength="150" required="required" />
            </div>
            <div class="col form-group">
                <label for="monto_cargo">Monto</label>
                <input type="text" class="form-control" id="monto_cargo" name="monto_cargo" value="" maxlength="10" required="required" />
            </div>
        </div>
        <button type="submit" class="btn btn-outline-primary">Aplicar Venta</button>
        {% endverbatim %}
    </form>
</script>

<script type="text/x-handlebars-template" id="aplicar-abono-template">
    <form method="post" onsubmit="return Prod.verifyPaymentInfo()" autocomplete="off" enctype="multipart/form-data">
        {% csrf_token %}
        {% verbatim %}
        <input type="hidden" name="action" value="addpayment" />
        <input type="hidden" name="cte" value="{{cte}}" />
        <div class="form-row">
            <div class="col form-group">
                <label for="fecha_abono">Fecha</label>
                <input type="date" class="form-control" id="fecha_abono" name="fecha_abono" value="{{today}}" required="required" />
            </div>
            <div class="col form-group">
                <label for="no_de_pago">No. de Pago</label>
                <input type="number" class="form-control" id="no_de_pago" name="no_de_pago" value="" required="required" min="1" max="999" />
            </div>
            <div class="col form-group">
                <label for="cargo">Aplicar al cargo</label>
                <select onchange="Prod.setPaymentInfo()" class="form-control" id="cargo" name="cargo" required="required"></select>
            </div>
        </div>
        <div class="form-row">
            <div class="col form-group">
                <label for="concepto_abono">Concepto</label>
                <input type="text" class="form-control" id="concepto_abono" name="concepto_abono" value="" maxlength="150" required="required" />
            </div>
            <div class="col form-group">
                <label for="monto_abono">Monto</label>
                <input type="text" class="form-control" id="monto_abono" name="monto_abono" value="" maxlength="10" required="required" />
            </div>
        </div>
        <button type="submit" class="btn btn-outline-primary">Aplicar Pago</button>
        {% endverbatim %}
    </form>
</script>

<table class="table table-striped table-sm table-responsive-md">
    <tbody id="data-tbl">
        {% if my_clients %}
            <tr><th colspan="4">Mis Clientes</th></tr>
            {% for cte in my_clients %}
                <tr>
                    <td>{{ cte }}</td>
                    <td>
                        <a href="{% url 'cargos_abonos_edocta' pk=cte.pk %}" class="btn btn-outline-success" title="Ver Estado de Cuenta">
                            <i class="fas fa-file-invoice-dollar"></i> 
                            <span class="d-none d-md-inline-block">Estado de Cuenta</span>
                        </a>
                    </td>
                    <td>
                        <button onclick="Prod.showChargeForm( {{ cte.pk }} )" type="button" class="btn btn-outline-primary">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="d-none d-md-inline-block">Aplicar </span>V<span class="d-none d-md-inline-block">enta</span>
                        </button>
                    </td>
                    <td>
                        <button onclick="Prod.showPaymentForm( {{ cte.pk }} )" type="button" class="btn btn-outline-primary">
                            <i class="fas fa-hand-holding-usd"></i>
                            <span class="d-none d-md-inline-block">Aplicar </span>P<span class="d-none d-md-inline-block">ago</span>
                        </button>
                    </td>
                </tr>
            {% endfor %}
        {% endif %}
        {% if all_clients %}
            <tr><th colspan="4">Todos los Clientes</th></tr>
            {% for cte in all_clients %}
                <tr>
                    <td>{{ cte }}</td>
                    <td>
                        <a href="{% url 'cargos_abonos_edocta' pk=cte.pk %}" class="btn btn-outline-success" title="Ver Estado de Cuenta">
                            <i class="fas fa-file-invoice-dollar"></i> 
                            <span class="d-none d-md-inline-block">Estado de Cuenta</span>
                        </a>
                    </td>
                    <td>
                        <button onclick="Prod.showChargeForm( {{ cte.pk }} )" type="button" class="btn btn-outline-primary">
                            <i class="fas fa-shopping-cart"></i>
                            <span class="d-none d-md-inline-block">Aplicar </span>V<span class="d-none d-md-inline-block">enta</span>
                        </button>
                    </td>
                    <td>
                        <button onclick="Prod.showPaymentForm( {{ cte.pk }} )" type="button" class="btn btn-outline-primary">
                            <i class="fas fa-hand-holding-usd"></i>
                            <span class="d-none d-md-inline-block">Aplicar </span>P<span class="d-none d-md-inline-block">ago</span>
                        </button>
                    </td>
                </tr>
            {% endfor %}
        {% endif %}
    </tbody>
</table>

{% endblock %}

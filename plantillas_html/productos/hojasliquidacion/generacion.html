{% extends "global/html_struct.html" %}
{% load humanize %}
{% load i18n %}

{% block content %}

{% if mensaje %}

<div class="alert alert-primary alert-dismissible fade show" role="alert">
    {{ mensaje }}
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>

{% endif %}

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="hidden" name="action" value="filter" />
    <div class="form-row">
        <div class="col form-group">
            <label for="fecha_inicio">Fecha Inicial:</label>
            <input type="date" class="form-control" name="fecha_inicio" id="fecha_inicio" value="{{ fecha_inicio | date:'Y-m-d' }}" />
        </div>
        <div class="col form-group">
            <label for="fecha_fin">Fecha Final:</label>
            <input type="date" class="form-control" name="fecha_fin" id="fecha_fin" value="{{ fecha_fin | date:'Y-m-d' }}" />
        </div>
        <div class="col form-group">
            <label for="idusrvendedor">Vendedor</label>
            <select class="form-control" id="idusrvendedor" name="idusrvendedor">
                <option value=""></option>
                {% if encargados.gerentes %}
                    <optgroup label="Gerentes">
                        {% for item in encargados.gerentes %}
                            <option value="{{ item.idusuario }}" {% if actual == item.idusuario %}selected="selected"{% endif %}>
                                {{ item }}
                            </option>
                        {% endfor%}
                    </optgroup>
                {% endif %}
                {% if encargados.vendedores %}
                    <optgroup label="Vendedores">
                        {% for item in encargados.vendedores %}
                            <option value="{{ item.idusuario }}" {% if actual == item.idusuario %}selected="selected"{% endif %}>
                                {{ item }}
                            </option>
                        {% endfor%}
                    </optgroup>
                {% endif %}
            </select>
        </div>
        <div class="col form-group">
            <label>&nbsp;</label>
            <button type="submit" class="btn btn-outline-secondary btn-block"><i class="fas fa-sync-alt"></i> Actualizar</button>
        </div>
    </div>
</form>

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <table class="table table-striped table-sm table-responsive-md">
        <thead>
            <tr>
                <th>Cliente</th>
                {% if show_vendedor %}
                    <th>Vendedor</th>
                {% endif %}
                <th>No. Pago</th>
                <th>Concepto</th>
                <th>Fecha</th>
                <th>Monto</th>
                <th></th>
            </tr>
        </thead>
        <tbody id="data-tbl">
            {% for reg in data %}
                <tr>
                    <td>{{ reg.cte }}</td>
                    {% if show_vendedor %}
                        <td>{{ reg.vend }}</td>
                    {% endif %}
                    <td>{{ reg.no }}</td>
                    <td>{{ reg.concepto }}</td>
                    <td>{{ reg.fecha | date:"d/m/Y" }}</td>
                    {% language 'en' %}
                        <td class="text-right">{{ reg.monto | intcomma }}</td>
                    {% endlanguage %}
                    <td>
                        <input onchange="Prod.sumTotalHL()" name="idpago" value="{{ reg.idpago }}" data-monto="{{ reg.monto }}" class="" type="checkbox" />
                    </td>
                </tr>
            {% endfor %}
        </tbody>
        <tfoot>
            <tr>
                {% if show_vendedor %}
                    <th colspan="5">Total</th>
                {% else %}
                    <th colspan="4">Total</th>
                {% endif %}
                <th class="text-right"><span id="total">0</span></th>
                <th></th>
            </tr>
        </tfoot>
    </table>

    <hr />

    <div class="form-row">
        <input type="hidden" name="action" value="create_hl" />
        <div class="col form-group">
            <label for="identificador">Identificador</label>
            <input id="identificador" name="identificador" type="text" maxlength="100" class="form-control" required="required" />
        </div>
        <div class="col form-group">
            <label for="fecha_entrega">Fecha de Entrega a Gerente</label>
            <input value="{{ today }}" id="fecha_entrega" name="fecha_entrega" type="date" class="form-control" required="required" />
        </div>
        <div class="col form-group">
            <label>&nbsp;</label>
            <button type="submit" class="btn btn-outline-secondary btn-block"><i class="far fa-newspaper"></i> Crear</button>
        </div>
    </div>
</form>

{% endblock %}
